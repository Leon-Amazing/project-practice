import{t as x,a as E,d as I}from"./utils-n8qi3FsM.js";import{d as W,a as p,r as R,z as C,j as b,n as z,I as H,J as B,c as _,b as L,F,H as $,K as N,L as q,o as f,N as D,G as M,w as P,e as U,f as V}from"./index-XMpUS58h.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as j}from"./water-fall-Dqt5XexZ.js";const A={class:"waterfall-container","element-loading-text":"拼命加载中...","element-loading-background":"rgba(255, 255, 255, 0.8)"},O={class:"waterfall-list"},G=W({__name:"WaterFall",props:{gap:{},column:{},pageSize:{},request:{type:Function}},setup(y){const e=y,n=p(),r=p([]),c=p([]),t=R({loading:!1,isfinish:!1,page:1,imageWidth:0,imageList:[]}),w=C(()=>{let o=-1,l=1/0;for(let s=0;s<r.value.length;s++){const a=r.value[s];a<l&&(o=s,l=a)}return{minIndex:o,minHeight:l}}),i=async(o,l,s)=>{if(t.isfinish)return;t.loading=!0,await I();const a=await e.request(o,l);if(t.page++,!a.length){t.isfinish=!0;return}h(a,s),t.imageList=[...t.imageList,...a],t.loading=!1},h=(o,l)=>{o.forEach((s,a)=>{const d=Math.floor(s.height*t.imageWidth/s.width);if(l&&a<e.column)c.value.push({x:a%e.column!==0?a*t.imageWidth+e.gap*a:a*t.imageWidth,y:0}),r.value.push(d+e.gap);else{const{minIndex:v,minHeight:k}=w.value;c.value.push({x:v%e.column!==0?v*t.imageWidth+e.gap*v:v*t.imageWidth,y:k}),r.value[v]+=d+e.gap}})},u=x(()=>{const{scrollTop:o,clientHeight:l,scrollHeight:s}=n.value;s-l-o<=100&&!t.loading&&i(t.page,e.pageSize,!1)}),m=E(()=>{n.value&&(t.imageWidth=(n.value.clientWidth-(e.column-1)*e.gap)/e.column,c.value=[],r.value=[],h(t.imageList,!0))},300),g=()=>{n.value&&(t.imageWidth=(n.value.clientWidth-(e.column-1)*e.gap)/e.column,i(t.page,e.pageSize,!0),n.value.addEventListener("scroll",u),window.addEventListener("resize",m))};return b(()=>{g()}),z(()=>{n.value&&n.value.removeEventListener("scroll",u),window.removeEventListener("resize",m)}),(o,l)=>{const s=B("loading");return H((f(),_("div",A,[L("div",{class:"waterfall-content",ref_key:"contentRef",ref:n},[L("div",O,[(f(!0),_(F,null,$(t.imageList,(a,d)=>(f(),_("div",{class:"waterfall-item",key:a.id,style:N({width:`${t.imageWidth}px`,transform:`translate3d(${c.value[d].x}px, ${c.value[d].y}px, 0)`})},[q(o.$slots,"item",{item:a},void 0,!0)],4))),128))])],512)])),[[s,t.loading]])}}}),J=S(G,[["__scopeId","data-v-5c541149"]]),K={BASE_URL:"/project-practice/"},T=W({__name:"waterfallContainer",setup(y){const e=p(0),n=p(null),r=new ResizeObserver(i=>{c(i[0].target.clientWidth)}),c=i=>{i>=960?e.value=6:i>=690&&i<960?e.value=5:i>=500&&i<690?e.value=4:e.value=2};b(()=>{n.value&&r.observe(n.value)}),z(()=>{n.value&&r.unobserve(n.value)});const{BASE_URL:t}=K,w=(i,h)=>new Promise(async u=>{const m=j.map(g=>({id:Math.random().toString(36).substring(2,9),url:t+g.url,height:g.height,width:g.width}));u(m)});return(i,h)=>{const u=V("el-image");return f(),_("div",{class:"waterfall-wrap",ref_key:"containerRef",ref:n},[e.value?(f(),D(J,{key:0,gap:20,column:e.value,request:w,"page-size":30},{item:P(({item:m})=>[U(u,{src:m.url,alt:"图片",class:"image",lazy:""},null,8,["src"])]),_:1},8,["column"])):M("",!0)],512)}}}),ee=S(T,[["__scopeId","data-v-91abd5fa"]]);export{ee as default};
