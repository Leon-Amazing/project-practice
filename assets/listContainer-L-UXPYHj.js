import{t as v,d as L}from"./utils-n8qi3FsM.js";import{d as _,a as $,r as p,z as o,A as k,j as f,n as B,I as C,J as M,c as l,b as d,K as h,F as V,H as z,L as E,o as r,e as R,w as T,l as F}from"./index-XMpUS58h.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N=["element-loading-text","element-loading-background"],j=_({__name:"VirtualList",props:{itemHeight:{},loading:{type:Boolean},loadingText:{default:"加载中"},loadingBg:{default:"rgba(255, 255, 255, 0.8)"},dataSource:{}},emits:["getData"],setup(c,{emit:a}){const t=c,n=a,e=$(),s=p({startIndex:0,viewHeight:0}),S=o(()=>Math.ceil(s.viewHeight/t.itemHeight)+1),u=o(()=>Math.min(s.startIndex+S.value,t.dataSource.length-1)),y=o(()=>t.dataSource.slice(s.startIndex,u.value)),H=o(()=>({height:`${t.itemHeight*(t.dataSource.length-s.startIndex)}px`,transform:`translate3d(0, ${t.itemHeight*s.startIndex}px, 0)`}));k(()=>u.value,i=>{i>=t.dataSource.length-1&&n("getData")});const g=v(()=>{const{scrollTop:i}=e.value;s.startIndex=Math.floor(i/t.itemHeight)}),I=v(()=>{s.viewHeight=e.value?e.value.offsetHeight:0}),b=()=>{e.value&&e.value.addEventListener("scroll",g),I()},w=()=>{e.value&&e.value.removeEventListener("scroll",g)};return f(()=>{b()}),B(()=>{w()}),(i,U)=>{const D=M("loading");return C((r(),l("div",{class:"virtuallist-container","element-loading-text":t.loadingText,"element-loading-background":t.loadingBg},[d("div",{class:"virtuallist-content",ref_key:"contentRef",ref:e},[d("div",{class:"virtuallist-list",style:h(H.value)},[(r(!0),l(V,null,z(y.value,m=>(r(),l("div",{class:"virtuallist-list-item",style:h({height:`${t.itemHeight}px`}),key:m.id},[E(i.$slots,"item",{item:m},void 0,!0)],4))),128))],4)],512)],8,N)),[[D,t.loading]])}}}),A=x(j,[["__scopeId","data-v-6bfb39a9"]]),G={class:"virtuallist-wrap"},J={class:"list-item"},K=_({__name:"listContainer",setup(c){const a=p({dataSource:[],loading:!1});f(()=>{t()});const t=async()=>{if(!a.loading){a.loading=!0,await L();for(let n=0;n<10;n++){const e=a.dataSource.length;a.dataSource.push({id:e+1})}a.loading=!1}};return(n,e)=>(r(),l("div",G,[R(A,{"data-source":a.dataSource,"item-height":100,loading:a.loading,"loading-text":"拼命加载中...","loading-bg":"rgba(255, 255, 255, 0.8)",onGetData:t},{item:T(({item:s})=>[d("div",J,F(s.id),1)]),_:1},8,["data-source","loading"])]))}}),Q=x(K,[["__scopeId","data-v-ab43c3cc"]]);export{Q as default};
